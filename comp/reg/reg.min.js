angular.module("app",[]),angular.module("app").controller("WizardController",[function(){var e=this;e.thisYear=(new Date).getFullYear();var t=["bagpipes","snare","tenor","bass"],n=[{name:"acknowledge"},{name:"payment"}],r=[{name:"step1"},{name:"competition",context:"competition"},{name:"bagpipes",context:"competition"},{name:"snare",context:"competition"},{name:"tenor",context:"competition"},{name:"bass",context:"competition"},{name:"workshop"},{name:"confirm"}];function o(t){e.paymentError=!0,e.paymentErrorMessage=t.message,e.refresh()}function s(){e.rating=0,e.hoverRating=0,e.feedback="",e.currentStepIndex=0,e.registrantIndex=0,e.currentFormName="step1Form",e.currentStepName="step1",e.steps=[],i(),function(){for(var t=0;t<n.length;t++)c(n[t],e.steps.length)}(),e.user=a(),e.users=[]}function a(){var e={comp:{},workshopPref:{}};return t.forEach((function(t){e.comp[t]={}})),e}function i(){for(var t=0===e.registrantIndex?0:e.steps.length-n.length,o=0;o<r.length;o++)c(r[o],o+t)}function c(t,n){var r=t.name;e.steps.splice(n,0,{registrantIndex:e.registrantIndex,stepIndex:n,name:r,template:r+".html?v1.0.2.0",formName:r+"Form",context:t.context,stepEnabled:!0})}s(),e.gotoStep=function(n){"step1"===e.steps[e.currentStepIndex].name?(e.steps.filter((function(t){return t.registrantIndex===e.registrantIndex&&"competition"===t.context})).forEach((function(t){t.stepEnabled=e.user.competition})),e.steps.filter((function(t){return t.registrantIndex===e.registrantIndex&&"workshop"===t.name}))[0].stepEnabled=e.user.workshop):"competition"===e.steps[e.currentStepIndex].name?function(){for(var n=0;n<t.length;n++)e.steps.filter((function(r){return r.registrantIndex===e.registrantIndex&&r.name===t[n]}))[0].stepEnabled=e.user.comp[t[n]].checked}():"confirm"===e.steps[e.currentStepIndex].name&&"No"!==(e.user.confirmAnother||"No")&&"Yes"===e.user.confirmAnother&&(e.registrantIndex++,i(),e.user=a());for(var r=e.currentStepIndex+n;!e.steps[r].stepEnabled;)r+=n;e.currentStepIndex=r,e.currentFormName=e.steps[r].formName,e.currentStepName=e.steps[r].name,"confirm"===e.currentStepName&&(e.users[e.registrantIndex]=angular.copy(e.user))},e.stepLoaded=function(){document.location="#","payment"===e.currentStepName&&setTimeout(e.renderPayPalButtons,250)},e.renderPayPalButtons=function(){paypal.Buttons({createOrder:function(t,n){return n.order.create(function(){var t={registration:{users:e.users,totalCost:e.total,paid:e.paid,acknowledge:e.acknowledge}},n=JSON.stringify(Object.flatten(t)).replace(/registration\./g,""),r=JSON.parse(n),o=[];for(let e in r)"{}"!==JSON.stringify(r[e])&&o.push({name:e,description:r[e],unit_amount:{currency_code:"USD",value:"0"},quantity:"1"});return o.unshift({name:"Summary",description:"Total Paid",unit_amount:{currency_code:"USD",value:e.total.toString()},quantity:"1"}),{purchase_units:[{amount:{currency_code:"USD",value:e.total.toString(),breakdown:{item_total:{currency_code:"USD",value:e.total.toString()}}},items:o}]}}())},onApprove:function(t,n){return n.order.capture().then((function(t){e.paid=!0,e.refresh()})).catch(o)},onError:o}).render("#paypal-button-container")},e.showNavButtons=function(){return"payment"!==e.currentStepName},e.refresh=function(){angular.element($("#wizard-content-container")).scope().$apply()},e.getStepTemplate=function(){return e.steps[e.currentStepIndex].template},e.disableNextButton=function(){return e[e.currentFormName]&&e[e.currentFormName].$invalid},e.displayYesNo=function(t){return e.user[t]?"Yes":"No"},e.getEvents=function(e,t){if(!e.comp[t].checked)return"";var n=[];for(var r in e.comp[t].events)n.push(e.comp[t].events[r]);return n.join(", ")},e.startOver=function(){var e;confirm("Are you sure you want to start completely over?")&&(s(),setTimeout((function(){document.location="#"}),e||1))},e.showAllNames=function(){return e.users.map((function(e){return e.name})).join(", ")},e.perEventCost=10,e.allEventsCost=30,e.workshopCost=30,e.eventDiscount=10,e.typicalMax=e.allEventsCost+e.workshopCost-e.eventDiscount,e.getEventCost=function(n){for(var r=0,o=0;o<t.length;o++)if(n.comp[t[o]].checked){var s=e.getEvents(n,t[o]).split(", ").length;r+=s*e.perEventCost<e.allEventsCost?s*e.perEventCost:e.allEventsCost}return n.competitionCost=r,r},e.displayWorkshopCost=function(t){return t.workshopCost=(t.competitionCost||0)>=e.allEventsCost?e.workshopCost-e.eventDiscount:e.workshopCost,t.workshopCost},e.displayTotalCost=function(){for(var t=0,n=0;n<e.users.length;n++)t+=(e.users[n].competitionCost||0)+(e.users[n].workshop&&e.users[n].workshopCost||0);return e.total=t,t}}]),Object.flatten=function(e){var t={};return function e(n,r){if(Object(n)!==n)t[r]=n;else if(Array.isArray(n)){for(var o=0,s=n.length;o<s;o++)e(n[o],r+"["+o+"]");0==s&&(t[r]=[])}else{var a=!0;for(var i in n)a=!1,e(n[i],r?r+"."+i:i);a&&r&&(t[r]={})}}(e,""),t};